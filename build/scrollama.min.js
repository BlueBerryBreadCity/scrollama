!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.scrollama=t()}(this,function(){"use strict";function e(e){for(var t=e.length,n=[],r=0;r<t;r+=1)n.push(e[r]);return n}function t(e){return"scrollama__debug-offset--"+e.id}function n(e){!function(e){var n=e.id,r=e.offsetVal,o=e.stepClass,i=document.createElement("div");i.setAttribute("id",t({id:n})),i.setAttribute("class","scrollama__debug-offset"),i.style.position="fixed",i.style.left="0",i.style.width="100%",i.style.height="0px",i.style.borderTop="2px dashed black",i.style.zIndex="9999";var s=document.createElement("p");s.innerText='".'+o+'" trigger: '+r,s.style.fontSize="12px",s.style.fontFamily="monospace",s.style.color="black",s.style.margin="0",s.style.padding="6px",i.appendChild(s),document.body.appendChild(i)}({id:e.id,offsetVal:e.offsetVal,stepClass:e.stepEl[0].getAttribute("class")})}function r(e){var n=e.id,r=(e.stepOffsetHeight,e.offsetMargin);e.offsetVal;!function(e){var n=e.id,r=e.offsetMargin,o=(e.offsetVal,t({id:n}));document.querySelector("#"+o).style.top=r+"px"}({id:n,offsetMargin:r})}function o(e){var t=e.id,n=e.index,r=e.state,o=function(e){return"scrollama__debug-step--"+e.id+"-"+e.i}({id:t,i:n}),i=document.querySelector("#"+o+"_above"),s=document.querySelector("#"+o+"_below"),a="enter"===r?"block":"none";i&&(i.style.display=a),s&&(s.style.display=a)}return function(){var t=["stepAbove","stepBelow","stepProgress","viewportAbove","viewportBelow"],i={stepEnter:function(){},stepExit:function(){},stepProgress:function(){}},s={},a=null,f=[],u=0,c=0,l=0,p=0,d=0,v=0,g=0,m=0,b=!1,x=!1,h=!1,w=!1,y=!1,E=!1,M=null,A=null,O=[];function I(e){var t=0;if(e.offsetParent)do{t+=e.offsetTop,e=e.offsetParent}while(e);return t<0?0:t}function S(e){return+e.getAttribute("data-scrollama-index")}function H(){window.pageYOffset>g?A="down":window.pageYOffset<g&&(A="up"),g=window.pageYOffset}function P(e){s[e]&&s[e].forEach(function(e){return e.disconnect()})}function q(){var e,t;l=window.innerHeight,e=document.body,t=document.documentElement,p=Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight),c=u*l,b&&(d=f.map(function(e){return e.offsetHeight}),v=f.map(I),x&&F()),h&&r({id:a,stepOffsetHeight:d,offsetMargin:c,offsetVal:u})}function _(e){if(e&&!x)return b&&F(),x=!0,!0;t.forEach(P),x=!1}function C(e,t){var n=S(e);void 0!==t&&(M[n].progress=t);var r={element:e,index:n,progress:M[n].progress};"enter"===M[n].state&&i.stepProgress(r)}function V(e,t){if("above"===t)for(var n=0;n<e;n++){var r=M[n];"enter"!==r.state&&"down"!==r.direction?(k(f[n],"down",!1),j(f[n],"down")):"enter"===r.state&&j(f[n],"down")}else if("below"===t)for(var o=M.length-1;o>e;o--){var i=M[o];"enter"===i.state&&j(f[o],"up"),"down"===i.direction&&(k(f[o],"up",!1),j(f[o],"up"))}}function k(e,t,n){void 0===n&&(n=!0);var r=S(e),s={element:e,index:r,direction:t};M[r].direction=t,M[r].state="enter",y&&n&&"down"===t&&V(r,"above"),y&&n&&"up"===t&&V(r,"below"),i.stepEnter&&!O[r]&&(i.stepEnter(s,M),h&&o({id:a,index:r,state:"enter"}),E&&(O[r]=!0)),w&&C(e)}function j(e,t){var n=S(e),r={element:e,index:n,direction:t};w&&("down"===t&&M[n].progress<1?C(e,1):"up"===t&&M[n].progress>0&&C(e,0)),M[n].direction=t,M[n].state="exit",i.stepExit(r,M),h&&o({id:a,index:n,state:"exit"})}function T(e){var t=e[0];H();var n=t.isIntersecting,r=t.boundingClientRect,o=t.target,i=r.top,s=r.bottom,a=i-c,f=s-c,u=S(o),l=M[u];n&&a<=0&&f>=0&&"down"===A&&"enter"!==l.state&&k(o,A),!n&&a>0&&"up"===A&&"enter"===l.state&&j(o,A)}function R(e){var t=e[0];H();var n=t.isIntersecting,r=t.boundingClientRect,o=t.target,i=r.top,s=r.bottom,a=i-c,f=s-c,u=S(o),l=M[u];n&&a<=0&&f>=0&&"up"===A&&"enter"!==l.state&&k(o,A),!n&&f<0&&"down"===A&&"enter"===l.state&&j(o,A)}function z(e){var t=e[0];H();var n=t.isIntersecting,r=t.target,o=S(r),i=M[o];n&&"down"===A&&"down"!==i.direction&&"enter"!==i.state&&(k(r,"down"),j(r,"down"))}function B(e){var t=e[0];H();var n=t.isIntersecting,r=t.target,o=S(r),i=M[o];n&&"up"===A&&"down"===i.direction&&"enter"!==i.state&&(k(r,"up"),j(r,"up"))}function N(e){var t=e[0];H();var n=t.isIntersecting,r=t.intersectionRatio,o=t.boundingClientRect,i=t.target,s=o.bottom;n&&s-c>=0&&C(i,+r.toFixed(3))}function Y(){s.stepProgress=f.map(function(e,t){var n=d[t]-c+"px 0px "+(-l+c)+"px 0px",r=function(e){for(var t=Math.ceil(e/m),n=[],r=1/t,o=0;o<t;o++)n.push(o*r);return n}(d[t]),o=new IntersectionObserver(N,{rootMargin:n,threshold:r});return o.observe(e),o})}function F(){t.forEach(P),s.viewportAbove=f.map(function(e,t){var n=p-v[t],r=-c-d[t],o=new IntersectionObserver(z,{rootMargin:n+"px 0px "+r+"px 0px"});return o.observe(e),o}),s.viewportBelow=f.map(function(e,t){var n=-c-d[t],r=-c-d[t]+p,o=new IntersectionObserver(B,{rootMargin:n+"px 0px "+r+"px 0px"});return o.observe(e),o}),s.stepAbove=f.map(function(e,t){var n=-c+d[t],r=new IntersectionObserver(T,{rootMargin:n+"px 0px "+-c+"px 0px"});return r.observe(e),r}),s.stepAbove=f.map(function(e,t){var n=-c,r=-c+d[t],o=new IntersectionObserver(R,{rootMargin:n+"px 0px "+r+"px 0px"});return o.observe(e),o}),w&&Y()}var D={};return D.setup=function(t){var r=t.step,o=t.offset;void 0===o&&(o=.5);var i=t.progress;void 0===i&&(i=!1);var s=t.threshold;void 0===s&&(s=4);var c=t.debug;void 0===c&&(c=!1);var l=t.order;void 0===l&&(l=!0);var p,d,v,g,x,A=t.once;return void 0===A&&(A=!1),d=(p="abcdefghijklmnopqrstuv").length,v=Date.now(),a=""+[0,0,0].map(function(e){return p[Math.floor(Math.random()*d)]}).join("")+v,g=r,void 0===x&&(x=document),(f="string"==typeof g?e(x.querySelectorAll(g)):g instanceof Element?e([g]):g instanceof NodeList?e(g):g instanceof Array?g:[]).length?(h=c,w=i,y=l,E=A,D.offsetTrigger(o),m=Math.max(1,+s),b=!0,h&&n({id:a,stepEl:f,offsetVal:u}),f.forEach(function(e,t){return e.setAttribute("data-scrollama-index",t)}),M=f.map(function(){return{direction:null,state:null,progress:0}}),q(),D.enable(),D):(console.error("scrollama error: no step elements"),D)},D.resize=function(){return q(),D},D.enable=function(){return _(!0),D},D.disable=function(){return _(!1),D},D.destroy=function(){_(!1),Object.keys(i).forEach(function(e){return i[e]=null}),Object.keys(s).forEach(function(e){return s[e]=null})},D.offsetTrigger=function(e){return e&&!isNaN(e)?(u=Math.min(Math.max(0,e),1),D):u},D.onStepEnter=function(e){return"function"==typeof e?i.stepEnter=e:console.error("scrollama error: onStepEnter requires a function"),D},D.onStepExit=function(e){return"function"==typeof e?i.stepExit=e:console.error("scrollama error: onStepExit requires a function"),D},D.onStepProgress=function(e){return"function"==typeof e?i.stepProgress=e:console.error("scrollama error: onStepProgress requires a function"),D},D}});
